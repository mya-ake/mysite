{"title":"実装面からコンポーネントの分割の仕方を考えてみた","description":"","body":"<h2 id=\"背景\">背景</h2><p>筆者が個人的に仕事を受けている会社のフロントエンドのプロジェクトを立ち上げることになりました。\nそこでせっかく新しく作る機会があるならコンポーネントの分割の仕方を明確に定義したいと思いました。</p>\n<p>そもそもなんで分け方を定義したいとなったかというと、後からメンバーがプロジェクトに入ってきたときに、スムーズにプロジェクトに入ってもらうためです。</p>\n<p>今まで作ってきたプロジェクトでのコンポーネントの分け方は、「2,3回使う場合はコンポーネントに分ける」\n「長くなって見通しが悪いコンポーネントは分ける」など曖昧なところもありますがシンプルなものでした。\nただこの分け方をするとコンポーネント自体が大きくなりがちでした。<br>今のところプロジェクトに関わる人数も少なく、個々のメンバーのレベルも高いため運用できていますが、人が増えた場合や他のメンバーとなった場合は「苦しいのではないか？」という気持ちがあります。</p>\n<p>このような背景があり自分の考えをまとめるためにもこの記事を書き始めました。</p>\n<h2 id=\"Atomic_Design_を導入することを考える\">Atomic Design を導入することを考える</h2><p>まずは目にすることが多くなった「Atomic Design」を導入することを考えてみました。</p>\n<p>ただAtomic Design はデザインシステムの1つです。\nあくまでもデザインにおける設計論です。\nそのため実装に関しての明確な手法は存在していないのが現状となっています。</p>\n<p>Atomic Design を知るために原典となる「<a href=\"http://atomicdesign.bradfrost.com\">Atomic Design by Brad Frost</a>」を読んで見ることにしました（長いので Chapter 2\nAtomic Design Methodology だけ読みました）。</p>\n<h3 id=\"ざっくり_Atomic_Design\">ざっくり Atomic Design</h3><p>Atomic Design は化学分野の原子や分子など物質の組成に関する機能を基に考えられたデザインシステムです。\nページにおけるパーツを次の5カテゴリに分類します。</p>\n<ul>\n<li>Atoms</li>\n<li>Molecules</li>\n<li>Organisms</li>\n<li>Templates</li>\n<li>Pages</li>\n</ul>\n<p>Atoms がもっとも小さく、Pages がもっとも大きいです。\n下のカテゴリが上のカテゴリをラップする感じになるので、下のカテゴリは上のカテゴリに依存します。その逆はありません。</p>\n<p>それぞれの筆者なりに要約しました。</p>\n<h4 id=\"Atoms\">Atoms</h4><p>Atoms は UI を構築するための最小単位です。\nこれ以上分割することができません。\n基本的には単体の HTML タグと同等な役割となります。</p>\n<p><a href=\"http://atomicdesign.bradfrost.com/chapter-2/#atoms\">http://atomicdesign.bradfrost.com/chapter-2/#atoms</a></p>\n<h4 id=\"Molecules\">Molecules</h4><p>Molecules は Atoms のグループです。\n比較的シンプルな UI 要素のグループとなります。\nたとえば検索フォームを例にすると、次の3つの Atoms から構成されます。\n便宜上基礎的な HTML タグで記述しています。</p>\n<pre><code class=\"hljs lang-HTML\">&lt;<span class=\"hljs-keyword\">form</span>&gt;\n  &lt;<span class=\"hljs-keyword\">label</span> <span class=\"hljs-keyword\">for</span>=<span class=\"hljs-string\">\"search\"</span>&gt;サイト内検索&lt;/<span class=\"hljs-keyword\">label</span>&gt;\n  &lt;<span class=\"hljs-keyword\">input</span> id=<span class=\"hljs-string\">\"search\"</span> <span class=\"hljs-keyword\">type</span>=<span class=\"hljs-string\">\"search\"</span> value=<span class=\"hljs-string\">\"\"</span>&gt;\n  &lt;button <span class=\"hljs-keyword\">type</span>=<span class=\"hljs-string\">\"submit\"</span>&gt;検索する&lt;/button&gt;\n&lt;/<span class=\"hljs-keyword\">form</span>&gt;\n</code></pre>\n<p><a href=\"http://atomicdesign.bradfrost.com/chapter-2/#molecules\">http://atomicdesign.bradfrost.com/chapter-2/#molecules</a></p>\n<h4 id=\"Organisms\">Organisms</h4><p>Organisms は、Atoms / Molecules / 他の Organism からなるグループです。\nUI における個別のセクションを表す複雑なコンポーネントとなります。</p>\n<p><a href=\"http://atomicdesign.bradfrost.com/chapter-2/#organisms\">http://atomicdesign.bradfrost.com/chapter-2/#organisms</a></p>\n<h4 id=\"Templates\">Templates</h4><p>Templates は Organisms / Molecules の集合です。\nこの段階で web サイトの 1 ページのワイヤーフレームのようになります。\nページのコンテンツは流し込まず、スケルトンでコンテンツを代替します。</p>\n<p>ちなみに Templates からは化学用語ではなくなります。\nその理由は徹底的にやるとステークホルダー（クライアントや上司など）を混乱させかねないからだそうです。</p>\n<p><a href=\"http://atomicdesign.bradfrost.com/chapter-2/#templates\">http://atomicdesign.bradfrost.com/chapter-2/#templates</a></p>\n<h4 id=\"Pages\">Pages</h4><p>Pages は Templates にコンテンツを流し込んだ状態です。\nこの段階ですべてが具体的になります。\nまた Pages はバリエーションを表現するための役割もあります。\n検索結果がない場合やページングなどのそのページにおけるバリエーションの変化がここで現れます。</p>\n<p><a href=\"http://atomicdesign.bradfrost.com/chapter-2/#pages\">http://atomicdesign.bradfrost.com/chapter-2/#pages</a></p>\n<h3 id=\"原典からわかったこと\">原典からわかったこと</h3><ul>\n<li>デザインを構築するための設計論</li>\n<li>当たり前だが実装方法については書いてない</li>\n<li>UI における分類に名前が付いてプロジェクトごとに定義しなくてよくなる</li>\n<li>コンポーネントベースなので使い回すことが前提でデザインが組み上がる</li>\n<li>コンポーネントを分割するときの1つの指標にできそう</li>\n</ul>\n<h2 id=\"Atomic_Design_で実装することを考える\">Atomic Design で実装することを考える</h2><p>原典を読んでなんとなく実装する際のコンポーネント分割の指標にできそうでした。\nただ 5 つのカテゴリの中でワイヤーフレームとなる Templates は不要そうです。\nそうすると「Atoms」「Molecules」「Organisms」「Pages」の4つになります。</p>\n<h3 id=\"Atomic_Design_の制約\">Atomic Design の制約</h3><p>Atomic Design をベースにするなら基本的には Atomic Design の制約に則り実装すべきであると筆者は考えます。\n現状の制約を表にすると次のようになります。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">カテゴリ</th>\n<th style=\"text-align:center\">依存してもいいもの</th>\n<th style=\"text-align:center\">依存の数</th>\n<th style=\"text-align:center\">備考</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Atoms</td>\n<td style=\"text-align:center\">なし</td>\n<td style=\"text-align:center\">0</td>\n<td style=\"text-align:center\">分割できてはいけない</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Molecules</td>\n<td style=\"text-align:center\">Atoms</td>\n<td style=\"text-align:center\">2 以上</td>\n<td style=\"text-align:center\">シンプル</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Organisms</td>\n<td style=\"text-align:center\">Atoms, Molecules, Organisims</td>\n<td style=\"text-align:center\">いくつでも</td>\n<td style=\"text-align:center\">複雑になりがち</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Pages</td>\n<td style=\"text-align:center\">Organisms</td>\n<td style=\"text-align:center\">いくつでも</td>\n<td style=\"text-align:center\">Organisms を組み合わせるだけ</td>\n</tr>\n</tbody>\n</table>\n<p>ただし、これだけの制約では実装するときに困ります。\n実装する際にはデータを必ず扱います。\nまたストアというグローバルなステートを保管している領域も存在します。\nこれらの扱いが定まっていないと予期せぬ依存が発生してしまい上記制約を満たすこともできなくなる可能性があります。\nそのためデータの流れやストアに関する制約も定めておく方が無難そうです。</p>\n<h3 id=\"データなどソースコードを書く上での制約\">データなどソースコードを書く上での制約</h3><h4 id=\"データフローの制約\">データフローの制約</h4><p>基本的にデータは Pages →　Organisms → Molecures → Atoms という順になるでしょう。\nまた逆に子から親へはイベントの伝播によってデータを渡すことになります。\nこの点に関しては最近の View 層のライブラリやフレームワークですでに制約があると思うのであまり気にする必要はなさそうです。</p>\n<h4 id=\"処理の制約\">処理の制約</h4><p>フローに関してはライブラリ、フレームワークレベルで担保されるので大丈夫ですが、それぞれのカテゴリでどこまで処理を行ってよいかの定義が必要だと考えます。\nたとえばどのカテゴリから API サーバーにリクエストを送ってよいか、具体的な処理（たとえばバリデーションなど）を行ってよいかなどです。</p>\n<p>Atoms や Molecules はシンプルに保つ必要があるので、ここに具体的な処理を書くのは違うように思えます。\nAtoms や Molecules では複数箇所で使われる前提なのでデータの受け付けとイベントの伝播だけに徹するのが無難そうです。</p>\n<p>そうすると Organisms と Pages で具体的な処理を書くことになります。\nただそれぞれはスコープが異なるのでなんでもしていいかというとそういうわけではないと考えます。\nOrganisms は特定のセクションになるので、自身が扱わないデータまで扱ってしまうと依存が別の方向にまで広がってしまいます。\nそのため Organisms では自身の扱うデータを超えない程度の API サーバーへのリクエスト（たとえば検索のコンポーネントならサジェストなど）のみを許可すべきでしょう。<br>Pages はそのページにおける最大のコンポーネントなので、Organims が扱えない範囲の API サーバーへのリクエストを行い、取得したデータが必要な Organisms に振り分ける役割を持たせます。</p>\n<h4 id=\"ストアへのアクセス権限の制約\">ストアへのアクセス権限の制約</h4><p>ストアは基本的にはどこからでもアクセスできるようになっていると思います。\n前述しましたがどこからでもアクセス可能だと予期せぬ依存が発生し得ます。</p>\n<p>ストアへのアクセスも処理の制約同様に Organisms か Pages で行うべきでしょう。\n認証状態などもすべて Organisms から Molecules へ渡します。</p>\n<p>Molecules で参照だけは可能にしてもよいかとも考えたのですが最終的には禁止としました。\nMolecules は複数箇所で使われる可能性が高いため、グローバルに依存していると予期せぬ同期などが発生しそうだと考えたからです。</p>\n<h4 id=\"ソースコードの制約まとめ\">ソースコードの制約まとめ</h4><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">カテゴリ</th>\n<th style=\"text-align:center\">処理</th>\n<th style=\"text-align:center\">ストアへのアクセス</th>\n<th style=\"text-align:center\">備考</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Atoms</td>\n<td style=\"text-align:center\">イベントの伝播のみ</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Molecules</td>\n<td style=\"text-align:center\">イベントの伝播のみ</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Organisms</td>\n<td style=\"text-align:center\">⭕</td>\n<td style=\"text-align:center\">⭕</td>\n<td style=\"text-align:center\">スコープを越えない範囲で</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Pages</td>\n<td style=\"text-align:center\">⭕</td>\n<td style=\"text-align:center\">⭕</td>\n<td style=\"text-align:center\">　</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"本当にこの分け方で大丈夫？\">本当にこの分け方で大丈夫？</h2><p>Presenter</p>\n<p>Atoms are UI elements that can’t be broken down any further and serve as the elemental building blocks of an interface.\nMolecules are collections of atoms that form relatively simple UI components.\nOrganisms are relatively complex components that form discrete sections of an interface.\nTemplates place components within a layout and demonstrate the design’s underlying content structure.\nPages apply real content to templates and articulate variations to demonstrate the final UI and test the resilience of the design system.</p>\n<p>原子は、それ以上分解することができず、インターフェースの要素ビルディングブロックとして機能するUI要素です。\n分子は、比較的単純なUIコンポーネントを形成する原子の集合です。\n生物は、インタフェースの個別のセクションを形成する比較的複雑なコンポーネントです。\nテンプレートは、レイアウト内にコンポーネントを配置し、デザインの基礎となるコンテンツ構造を実演します。\nページは実際のコンテンツをテンプレートに適用し、バリエーションを明確にして最終的なUIを実演し、デザインシステムの復元力をテストします。</p>\n<p>10 reason</p>\n<p>You can mix and match components\nCreating a style guide is simple\nEasy to understand layout\nCode is more consistent\nNo focus on pixel-perfect designs\nQuicker prototyping\nEasier to update and remove parts of the site\nMore modular file structure\nFewer components overall\nExplore Pattern Lab</p>","thumbnail":"","twitterCardType":"","createdAt":"2018-11-10"}